Комментарии с кодом оставил специально.
Прошу полностью просмотреть код, потому что могут быть функции и/или фишки, которые вы можете не заметить (например, неавторизированный пользователь может просматривать профиля других пользователей, но когда захочет посмотреть свой профиль, его перенаправит на страницу с логином)
